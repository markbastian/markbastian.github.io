<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Using juxt to Compute Signed Angular Distances</title>
    <link rel="stylesheet" type="text/css" href="../resources/css/style.css"/>
    <link rel="stylesheet" href="../bower_components/highlightjs/styles/zenburn.css">
    <script src="../bower_components/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<main>
    <h3>March 31, 2015</h3>
    <span style="font-family: Arial, Helvetica, sans-serif;">Juxt is one of those weird Clojure functions that just doesn't make sense until you see it in action. However, once you get it, you love it. This short example shows a great use of the juxt function.</span><br />
    <div>
        <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
        <span style="font-family: Arial, Helvetica, sans-serif;">What does juxt do? It creates a function that is the application of a list of functions to a single argument. In simpler terms, a&nbsp;typical function returns one&nbsp;result for one input. In the case of&nbsp;juxt, you create a function&nbsp;that&nbsp;returns n results for one input. The n results are computed from the n functions that you juxtapose.</span><br />
        <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
        <span style="font-family: Arial, Helvetica, sans-serif;">For example, suppose you need both the cosine and sine x for a given application. You could create two separate variables, like so:</span><br />
        <div>
<pre><code>(defn angle-&gt;cartesian
"Convert an angle (in radians) to its cartesian vector
equivalent."
  [theta]
  (let[x (Math/cos theta)
       y (Math/sin theta)]
    [x y]))
</code></pre>
        </div>
        <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
        <span style="font-family: Arial, Helvetica, sans-serif;">However, it is more convenient to juxtapose (set side by side) the two items being computed into a single vector.</span></div>
    <div>
        <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
        <span style="font-family: Arial, Helvetica, sans-serif;">Here's a problem that builds on the above to show how nice juxt is:</span></div>
    <div>
        <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
        <span style="font-family: Arial, Helvetica, sans-serif;">You are given two angles in degrees and need to compute the signed distance between them. These angles aren't constrained to [0, 360). If the angles are outside of this range, we want to use the equivalent&nbsp;angle within the desired range. Here are a few examples of the desired output:</span><br />
        <br /></div>
    <table style="border-collapse: collapse; border-color: #ccc; border-spacing: 0;"><tbody>
    <tr><th style="background-color: #f0f0f0; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; font-weight: normal; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">First Angle</th><th style="background-color: #f0f0f0; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; font-weight: normal; overflow: hidden; padding: 10px 5px; word-break: normal;">Second Angle</th><th style="background-color: #f0f0f0; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; font-weight: normal; overflow: hidden; padding: 10px 5px; word-break: normal;">Signed Distance</th></tr>
    <tr><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">10</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">20</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">10</td></tr>
    <tr><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">20</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">10</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">-10</td></tr>
    <tr><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">350</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">10</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">20</td></tr>
    <tr><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">10</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">350</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">-20</td></tr>
    <tr><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">-350</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">350</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">-20</td></tr>
    <tr><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">350</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">-350</td><td style="background-color: white; border-color: #ccc; border-style: solid; border-width: 1px; color: #333333; font-family: Arial, sans-serif; font-size: 14px; overflow: hidden; padding: 10px 5px; text-align: center; word-break: normal;">20</td></tr>
    </tbody></table>
    <div>
        <br /></div>
    <div>
        <span style="font-family: Arial, Helvetica, sans-serif;">You can probably solve this problem with some combination of mod, rem, and/or quot, but I find it much easier to simply transform the angles to their cartesian vector form and do the math in that coordinate system. Recall that for unit vectors the dot product of vectors A and B is A*B=cos(<span style="color: #252525; line-height: 22px;">θ), where&nbsp;</span><span style="color: #252525;"><span style="line-height: 22px;">θ is the angle between the vectors. Likewise,&nbsp;</span></span>the sign of the cross product of the vectors indicates the the direction of rotation via the right hand rule. So, I can use dot to compute my angular offset and cross to determine the direction.</span></div>
    <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
    <span style="font-family: Arial, Helvetica, sans-serif;">With that knowledge, here's my function to compute angular distances:</span>
    <br />
    <div>
<pre><code>(defn angular-delta
"Compute the difference between two angles,
where angles are in degrees."
[a b]
(let [[u v] (map (juxt #(Math/cos %) #(Math/sin %))
                 (map #(Math/toRadians %) [a b]))
      theta (Math/acos (reduce + (map * u v)))
      sign (Math/signum (reduce - (map * u (reverse v))))]
  (Math/toDegrees (* sign theta))))
</code></pre>
    </div>
    <br />
    <span style="font-family: Arial, Helvetica, sans-serif;">Pretty slick, eh? Notice how the combination of&nbsp;juxt and destructuring (the automagic mapping of the&nbsp;result to the [x y] vector) both shortened my code and created a single vector structure, which communicated my intent. As an afterthought, let me state that I am only converting to degrees since they are easier on the eyes for most humans. In the real world, I'd leave the function in terms of radians since, in the words of my favorite college math professor, "Degrees are for temperature, radians are for math."</span><br />
    <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
    <span style="font-family: Arial, Helvetica, sans-serif;">Does this all give the right answer? Let the REPL decide:</span><br />
    <div>
<pre><code>(defn angular-delta
  "Compute the difference between two angles,
  where angles are in degrees."
  [a b]
  (let [[u v] (map (juxt #(Math/cos %) #(Math/sin %))
                   (map #(Math/toRadians %) [a b]))
        theta (Math/acos (reduce + (map * u v)))
        sign (Math/signum (reduce - (map * u (reverse v))))]
    (Math/toDegrees (* sign theta))))
=&gt; #'user/angular-delta
(angular-delta 10 20)
=&gt; 10.000000000000012
(angular-delta 20 10)
=&gt; -10.000000000000012
(angular-delta 350 10)
=&gt; 20.00000000000001
(angular-delta 10 350)
=&gt; -20.00000000000001
(angular-delta -350 350)
=&gt; -20.00000000000001
(angular-delta 350 -350)
=&gt; 20.00000000000001
</code></pre>
    </div>
    <br />
    <span style="font-family: Arial, Helvetica, sans-serif;">Ignoring the precision issues, this gives just the right answer.</span><br />
    <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
    <span style="font-family: Arial, Helvetica, sans-serif;">I hope this provides a nice explanation of how you might use juxt in a real&nbsp;problem. There are many other similar cases where you need to compute several independent variations of an initial value to perform a computation. Whenever you need do to this, use juxt.</span><br />
    <span style="font-family: Arial, Helvetica, sans-serif;"><br /></span>
    <span style="font-family: Arial, Helvetica, sans-serif;">If you liked this page or learned anything from it, please tweet the link and/or follow me on Twitter. Your support and interest is the fuel that drives the effort.</span><br />
    <a class="twitter-share-button" data-url="http://fn-code.blogspot.com/2015/03/using-juxt-to-compute-signed-angular.html" data-via="mark_bastian" href="https://twitter.com/share">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    <a class="twitter-follow-button" data-show-count="false" href="https://twitter.com/mark_bastian">Follow @mark_bastian</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    <a class="twitter-hashtag-button" data-related="mark_bastian" href="https://twitter.com/intent/tweet?button_hashtag=clojure">Tweet #clojure</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</main>
</body>
</html>